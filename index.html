<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ExpenseFlow Pro - Premium Edition</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<style>
  * { 
    font-family: 'Inter', sans-serif; 
    scroll-behavior: smooth;
  }
  
  :root {
    --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --premium-black: #0a0a0b;
    --dark-surface: #151518;
    --card-surface: #1a1a1d;
    --accent-purple: #8b5cf6;
    --accent-gold: #f59e0b;
    --text-primary: #ffffff;
    --text-secondary: #a1a1aa;
    --border-subtle: #27272a;
    --success: #10b981;
    --error: #ef4444;
    --warning: #f59e0b;
  }
  
  body {
    background: var(--premium-black);
    background-image: 
      radial-gradient(circle at 20% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, rgba(245, 158, 11, 0.1) 0%, transparent 50%),
      radial-gradient(circle at 40% 40%, rgba(16, 185, 129, 0.05) 0%, transparent 50%);
    min-height: 100vh;
  }
  
  .glass {
    background: rgba(26, 26, 29, 0.8);
    backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .glass-hover:hover {
    background: rgba(26, 26, 29, 0.9);
    border-color: rgba(139, 92, 246, 0.3);
    transform: translateY(-2px);
  }
  
  .premium-card {
    background: linear-gradient(145deg, #1a1a1d 0%, #151518 100%);
    border: 1px solid var(--border-subtle);
    position: relative;
    overflow: hidden;
  }
  
  .premium-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.5), transparent);
  }
  
  .premium-gradient {
    background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-gold) 100%);
  }
  
  .btn-premium {
    background: linear-gradient(135deg, var(--accent-purple), var(--accent-gold));
    border: none;
    position: relative;
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .btn-premium::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.6s;
  }
  
  .btn-premium:hover::before {
    left: 100%;
  }
  
  .btn-premium:hover {
    transform: translateY(-2px) scale(1.02);
    box-shadow: 0 20px 40px rgba(139, 92, 246, 0.3);
  }
  
  .icon-container {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    border-radius: 12px;
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(245, 158, 11, 0.2));
    border: 1px solid rgba(139, 92, 246, 0.3);
    position: relative;
  }
  
  .icon-container i {
    font-size: 20px;
    background: linear-gradient(135deg, var(--accent-purple), var(--accent-gold));
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  
  .stat-card {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
  }
  
  .stat-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
  }
  
  .floating-orb {
    position: absolute;
    border-radius: 50%;
    pointer-events: none;
    animation: float 6s ease-in-out infinite;
  }
  
  @keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    33% { transform: translateY(-20px) rotate(120deg); }
    66% { transform: translateY(10px) rotate(240deg); }
  }
  
  .glow-text {
    text-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
  }
  
  .notification {
    position: fixed;
    top: 2rem;
    right: 2rem;
    z-index: 100;
    transform: translateX(400px);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(20px);
  }
  
  .notification.show {
    transform: translateX(0);
  }
  
  .ai-suggestion {
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(139, 92, 246, 0.1));
    border: 1px solid rgba(16, 185, 129, 0.3);
    animation: pulse-subtle 3s ease-in-out infinite;
  }
  
  @keyframes pulse-subtle {
    0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
    50% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
  }
  
  .voice-wave {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 2px;
  }
  
  .voice-wave span {
    width: 3px;
    height: 20px;
    background: linear-gradient(135deg, var(--accent-purple), var(--accent-gold));
    border-radius: 2px;
    animation: wave 1.2s ease-in-out infinite;
  }
  
  .voice-wave span:nth-child(2) { animation-delay: 0.1s; }
  .voice-wave span:nth-child(3) { animation-delay: 0.2s; }
  .voice-wave span:nth-child(4) { animation-delay: 0.3s; }
  
  @keyframes wave {
    0%, 100% { transform: scaleY(0.3); }
    50% { transform: scaleY(1); }
  }
  
  .smart-input {
    position: relative;
  }
  
  .smart-input.ai-active::after {
    content: '';
    position: absolute;
    top: 50%;
    right: 12px;
    transform: translateY(-50%);
    width: 8px;
    height: 8px;
    background: var(--success);
    border-radius: 50%;
    animation: pulse 2s infinite;
  }
  
  .expense-item {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border-left: 4px solid transparent;
  }
  
  .expense-item:hover {
    transform: translateX(8px);
    border-left-color: var(--accent-purple);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  }
  
  .biometric-btn {
    background: radial-gradient(circle, rgba(139, 92, 246, 0.2) 0%, transparent 70%);
    border: 2px solid transparent;
    background-clip: padding-box;
    position: relative;
  }
  
  .biometric-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    padding: 2px;
    background: linear-gradient(135deg, var(--accent-purple), var(--accent-gold));
    border-radius: inherit;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
  }
  
  .progress-ring {
    position: relative;
    width: 100px;
    height: 100px;
  }
  
  .progress-ring svg {
    transform: rotate(-90deg);
  }
  
  .progress-ring circle {
    fill: none;
    stroke-width: 8;
    stroke-linecap: round;
  }
  
  .modal-backdrop {
    backdrop-filter: blur(12px) saturate(150%);
    background: rgba(0, 0, 0, 0.8);
  }
  
  .security-question-container {
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(139, 92, 246, 0.1));
    border: 1px solid rgba(239, 68, 68, 0.3);
  }

  .custom-scrollbar::-webkit-scrollbar {
    width: 6px;
  }
  
  .custom-scrollbar::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
  }
  
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, var(--accent-purple), var(--accent-gold));
    border-radius: 10px;
  }

  .hidden { display: none !important; }
  .tag-item {
    background: rgba(139, 92, 246, 0.2);
    color: white;
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 12px;
    display: inline-flex;
    align-items: center;
    gap: 4px;
  }
</style>
</head>

<body>
<!-- Orbes flottantes d'ambiance -->
<div class="floating-orb w-32 h-32 bg-gradient-to-r from-purple-500/20 to-blue-500/20 top-20 left-20" style="animation-delay: 0s;"></div>
<div class="floating-orb w-24 h-24 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 top-40 right-32" style="animation-delay: 2s;"></div>
<div class="floating-orb w-20 h-20 bg-gradient-to-r from-green-500/20 to-teal-500/20 bottom-32 left-1/3" style="animation-delay: 4s;"></div>

<!-- √âCRAN DE CONNEXION PREMIUM -->
<div id="loginScreen" class="fixed inset-0 flex justify-center items-center z-50 modal-backdrop">
  <div class="glass rounded-3xl p-8 w-96 relative overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-br from-purple-500/10 to-yellow-500/10"></div>
    
    <div class="relative text-center mb-8">
      <div class="w-20 h-20 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-purple-500 to-yellow-500 flex items-center justify-center">
        <i class="fas fa-wallet text-3xl text-white"></i>
      </div>
      <h1 class="text-3xl font-bold text-white mb-2 glow-text">ExpenseFlow Pro</h1>
      <p class="text-gray-300">Votre assistant financier intelligent avec IA</p>
    </div>
    
    <form id="loginForm" class="space-y-6 relative">
      <div class="space-y-4">
        <h2 id="formTitle" class="text-xl font-semibold text-white text-center">Connexion S√©curis√©e</h2>
        
        <div class="smart-input">
          <div class="relative">
            <i class="fas fa-user absolute left-4 top-1/2 transform -translate-y-1/2 text-purple-400"></i>
            <input type="text" id="username" placeholder="Nom d'utilisateur" 
                   class="w-full pl-12 pr-4 py-4 bg-black/30 border border-white/20 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all" required />
          </div>
        </div>
        
        <div class="smart-input">
          <div class="relative">
            <i class="fas fa-lock absolute left-4 top-1/2 transform -translate-y-1/2 text-purple-400"></i>
            <input type="password" id="password" placeholder="Mot de passe" 
                   class="w-full pl-12 pr-12 py-4 bg-black/30 border border-white/20 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all" required />
            <button type="button" id="togglePassword" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white">
              <i class="fas fa-eye"></i>
            </button>
          </div>
        </div>
        
        <div class="relative hidden" id="maxThresholdContainer">
          <div class="relative">
            <i class="fas fa-coins absolute left-4 top-1/2 transform -translate-y-1/2 text-yellow-400"></i>
            <input type="number" id="maxThreshold" placeholder="Budget mensuel (DH)" min="1" 
                   class="w-full pl-12 pr-4 py-4 bg-black/30 border border-white/20 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all" />
          </div>
        </div>
        
        <!-- Questions de s√©curit√© pour l'inscription -->
        <div class="hidden" id="securityQuestionContainer">
          <div class="security-question-container p-4 rounded-xl mb-4">
            <label class="block text-sm font-medium text-white mb-2">Question de s√©curit√©</label>
            <select id="securityQuestion" class="w-full p-3 bg-black/30 border border-red-400/50 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-red-500">
              <option value="">Choisir une question...</option>
              <option value="pet">Quel √©tait le nom de votre premier animal de compagnie ?</option>
              <option value="school">Dans quelle √©cole primaire avez-vous √©tudi√© ?</option>
              <option value="mother">Quel est le nom de jeune fille de votre m√®re ?</option>
              <option value="city">Dans quelle ville √™tes-vous n√©(e) ?</option>
              <option value="friend">Quel est le pr√©nom de votre meilleur ami d'enfance ?</option>
            </select>
          </div>
          <div class="relative">
            <i class="fas fa-key absolute left-4 top-1/2 transform -translate-y-1/2 text-red-400"></i>
            <input type="text" id="securityAnswer" placeholder="Votre r√©ponse" 
                   class="w-full pl-12 pr-4 py-4 bg-black/30 border border-red-400/50 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all" />
          </div>
        </div>
      </div>
      
      <!-- Authentification biom√©trique simul√©e -->
      <div class="hidden" id="biometricAuth">
        <button type="button" id="biometricBtn" class="w-full biometric-btn p-4 rounded-xl text-white font-medium transition-all">
          <div class="flex items-center justify-center space-x-3">
            <i class="fas fa-fingerprint text-xl"></i>
            <span>Authentification Biom√©trique</span>
          </div>
        </button>
      </div>
      
      <button type="submit" id="submitBtn" 
              class="w-full btn-premium text-white px-6 py-4 rounded-xl font-semibold transition-all duration-300">
        <i class="fas fa-sign-in-alt mr-2"></i>
        Se connecter
      </button>
      
      <div class="flex justify-center space-x-6 text-sm">
        <button type="button" id="btnLogin" class="text-white hover:text-purple-300 transition-colors font-medium">
          <i class="fas fa-sign-in-alt mr-1"></i> Connexion
        </button>
        <span class="text-gray-400">‚Ä¢</span>
        <button type="button" id="btnRegister" class="text-white hover:text-yellow-300 transition-colors font-medium">
          <i class="fas fa-user-plus mr-1"></i> S'inscrire
        </button>
        <span class="text-gray-400">‚Ä¢</span>
        <button type="button" id="btnForgotPassword" class="text-white hover:text-red-300 transition-colors font-medium">
          <i class="fas fa-question-circle mr-1"></i> Mot de passe oubli√©
        </button>
      </div>
    </form>
  </div>
</div>

<!-- MODAL R√âCUP√âRATION MOT DE PASSE -->
<div id="forgotPasswordModal" class="hidden fixed inset-0 flex justify-center items-center z-60 modal-backdrop">
  <div class="glass rounded-3xl p-8 w-96 relative">
    <div class="text-center mb-6">
      <div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-red-500 to-orange-500 flex items-center justify-center">
        <i class="fas fa-key text-2xl text-white"></i>
      </div>
      <h2 class="text-2xl font-bold text-white mb-2">R√©cup√©ration</h2>
      <p class="text-gray-300 text-sm">R√©pondez √† votre question de s√©curit√©</p>
    </div>
    
    <form id="forgotPasswordForm" class="space-y-4">
      <div class="relative">
        <i class="fas fa-user absolute left-4 top-1/2 transform -translate-y-1/2 text-purple-400"></i>
        <input type="text" id="forgotUsername" placeholder="Nom d'utilisateur" 
               class="w-full pl-12 pr-4 py-4 bg-black/30 border border-white/20 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500" required />
      </div>
      
      <div id="securityQuestionDisplay" class="hidden p-4 bg-gradient-to-r from-red-500/20 to-orange-500/20 rounded-xl border border-red-400/30">
        <p class="text-white font-medium mb-2">Question de s√©curit√© :</p>
        <p id="questionText" class="text-gray-300 text-sm"></p>
      </div>
      
      <div class="relative hidden" id="securityAnswerContainer">
        <i class="fas fa-key absolute left-4 top-1/2 transform -translate-y-1/2 text-red-400"></i>
        <input type="text" id="forgotSecurityAnswer" placeholder="Votre r√©ponse" 
               class="w-full pl-12 pr-4 py-4 bg-black/30 border border-red-400/50 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-red-500" />
      </div>
      
      <div class="flex space-x-3">
        <button type="button" id="closeForgotModal" 
                class="flex-1 bg-white/10 hover:bg-white/20 text-white px-6 py-4 rounded-xl transition-all duration-300">
          Annuler
        </button>
        <button type="submit" 
                class="flex-1 btn-premium text-white px-6 py-4 rounded-xl font-semibold">
          <i class="fas fa-unlock mr-2"></i>
          R√©cup√©rer
        </button>
      </div>
    </form>
  </div>
</div>

<!-- NOTIFICATION SYST√àME PREMIUM -->
<div id="notification" class="notification glass rounded-xl shadow-2xl">
  <div class="flex items-center space-x-3 p-4">
    <div class="icon-container w-10 h-10">
      <i id="notificationIcon" class="fas fa-check"></i>
    </div>
    <div>
      <p id="notificationTitle" class="font-semibold text-white text-sm"></p>
      <p id="notificationText" class="text-gray-300 text-xs"></p>
    </div>
    <button id="closeNotification" class="text-gray-400 hover:text-white ml-auto">
      <i class="fas fa-times"></i>
    </button>
  </div>
</div>

<!-- HEADER PREMIUM -->
<header class="glass sticky top-0 z-30 p-6 border-b border-white/10">
  <div class="max-w-7xl mx-auto flex justify-between items-center">
    <div class="flex items-center space-x-4">
      <div class="icon-container">
        <i class="fas fa-hand-peace text-2xl"></i>
      </div>
      <div>
        <h1 class="text-xl font-bold text-white">
          Bonjour <span id="userDisplay" class="glow-text">Utilisateur</span>
        </h1>
        <p class="text-gray-400 text-sm">G√©rez vos finances avec l'IA</p>
      </div>
    </div>
    
    <div class="flex items-center space-x-3">
      <!-- Commande vocale -->
      <button id="voiceBtn" class="glass glass-hover p-3 rounded-xl text-white relative">
        <div id="voiceWave" class="voice-wave hidden">
          <span></span><span></span><span></span><span></span>
        </div>
        <i id="voiceIcon" class="fas fa-microphone"></i>
      </button>
      
      <!-- IA Assistant -->
      <button id="aiBtn" class="glass glass-hover p-3 rounded-xl text-white">
        <i class="fas fa-robot"></i>
      </button>
      
      <!-- Param√®tres -->
      <div class="relative">
        <button id="settingsBtn" class="glass glass-hover p-3 rounded-xl text-white">
          <i class="fas fa-cog"></i>
        </button>
        <div id="settingsDropdown" class="absolute right-0 mt-2 w-56 glass rounded-xl shadow-xl hidden border border-white/10">
          <div class="p-2">
            <button id="thresholdBtn" class="w-full text-left px-4 py-3 text-white hover:bg-white/10 rounded-lg transition-colors flex items-center">
              <i class="fas fa-coins w-5 text-yellow-400 mr-3"></i>
              Modifier budget
            </button>
            <button id="exportBtn" class="w-full text-left px-4 py-3 text-white hover:bg-white/10 rounded-lg transition-colors flex items-center">
              <i class="fas fa-download w-5 text-blue-400 mr-3"></i>
              Exporter CSV
            </button>
            <button id="backupBtn" class="w-full text-left px-4 py-3 text-white hover:bg-white/10 rounded-lg transition-colors flex items-center">
              <i class="fas fa-cloud-upload-alt w-5 text-green-400 mr-3"></i>
              Sauvegarde Cloud
            </button>
            <button id="analyticsBtn" class="w-full text-left px-4 py-3 text-white hover:bg-white/10 rounded-lg transition-colors flex items-center">
              <i class="fas fa-chart-line w-5 text-purple-400 mr-3"></i>
              Analytics IA
            </button>
            <hr class="border-white/10 my-2">
            <button id="resetBtn" class="w-full text-left px-4 py-3 text-white hover:bg-white/10 rounded-lg transition-colors flex items-center">
              <i class="fas fa-trash w-5 text-red-400 mr-3"></i>
              R√©initialiser
            </button>
          </div>
        </div>
      </div>
      
      <button id="logoutBtn" class="glass glass-hover p-3 rounded-xl text-white">
        <i class="fas fa-sign-out-alt"></i>
      </button>
    </div>
  </div>
</header>

<main class="max-w-7xl mx-auto p-6 space-y-8">
  <!-- CONTR√îLES DE MOIS PREMIUM -->
  <div class="premium-card rounded-2xl p-6">
    <div class="flex flex-wrap items-center justify-between gap-4">
      <div class="flex items-center space-x-4">
        <label class="text-white font-medium flex items-center">
          <i class="fas fa-calendar-alt mr-2 text-purple-400"></i>
          P√©riode :
        </label>
        <input type="month" id="monthSelect" 
               class="bg-black/30 border border-white/20 rounded-xl px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"/>
        <button id="goCurrentMonth" 
                class="glass glass-hover text-white px-4 py-2 rounded-xl transition-all">
          <i class="fas fa-calendar-day mr-2"></i>Ce mois
        </button>
      </div>
      
      <div class="flex items-center space-x-4">
        <!-- Cercle de progression premium -->
        <div class="progress-ring">
          <svg width="60" height="60">
            <circle cx="30" cy="30" r="25" stroke="#333" stroke-width="4"/>
            <circle id="progressCircle" cx="30" cy="30" r="25" stroke="url(#gradient)" stroke-width="4" 
                    fill="none" stroke-dasharray="157" stroke-dashoffset="157"/>
            <defs>
              <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#8b5cf6"/>
                <stop offset="100%" style="stop-color:#f59e0b"/>
              </linearGradient>
            </defs>
          </svg>
          <div class="absolute inset-0 flex items-center justify-center">
            <span id="budgetPercentage" class="text-white text-xs font-bold">0%</span>
          </div>
        </div>
        <div class="text-right">
          <p class="text-gray-400 text-sm">Budget utilis√©</p>
          <p id="budgetUsed" class="text-white font-semibold">0 DH</p>
        </div>
      </div>
    </div>
  </div>

  <!-- SUGGESTIONS IA -->
  <div id="aiSuggestions" class="hidden ai-suggestion rounded-2xl p-6">
    <div class="flex items-start space-x-4">
      <div class="icon-container">
        <i class="fas fa-lightbulb"></i>
      </div>
      <div class="flex-1">
        <h3 class="text-white font-semibold mb-2">üí° Suggestions IA</h3>
        <div id="suggestionsList" class="space-y-2"></div>
      </div>
      <button id="closeSuggestions" class="text-gray-400 hover:text-white">
        <i class="fas fa-times"></i>
      </button>
    </div>
  </div>

  <!-- STATISTIQUES PRINCIPALES PREMIUM -->
  <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
    <div class="stat-card premium-card rounded-2xl p-6 text-center">
      <div class="icon-container mx-auto mb-4">
        <i class="fas fa-credit-card text-2xl"></i>
      </div>
      <p class="text-gray-400 text-sm mb-2">Total D√©penses</p>
      <p id="totalExpenses" class="text-3xl font-bold text-white glow-text">0 DH</p>
      <div class="text-xs text-gray-500 mt-1">
        <i class="fas fa-arrow-up text-red-400"></i>
        <span id="expenseChange">+0%</span> ce mois
      </div>
    </div>

    <div class="stat-card premium-card rounded-2xl p-6 text-center">
      <div class="icon-container mx-auto mb-4">
        <i class="fas fa-piggy-bank text-2xl"></i>
      </div>
      <p class="text-gray-400 text-sm mb-2">Budget Restant</p>
      <p id="remainingBudget" class="text-3xl font-bold text-white glow-text">0 DH</p>
      <div class="text-xs text-gray-500 mt-1">
        <i class="fas fa-shield-alt text-green-400"></i>
        <span id="budgetHealth">Sain</span>
      </div>
    </div>
    
    <div class="stat-card premium-card rounded-2xl p-6 text-center">
      <div class="icon-container mx-auto mb-4">
        <i class="fas fa-exchange-alt text-2xl"></i>
      </div>
      <p class="text-gray-400 text-sm mb-2">Transactions</p>
      <p id="totalTransactions" class="text-3xl font-bold text-white glow-text">0</p>
      <div class="text-xs text-gray-500 mt-1">
        <i class="fas fa-chart-line text-blue-400"></i>
        <span id="transactionTrend">Stable</span>
      </div>
    </div>
    
    <div class="stat-card premium-card rounded-2xl p-6 text-center">
      <div class="icon-container mx-auto mb-4">
        <i class="fas fa-calculator text-2xl"></i>
      </div>
      <p class="text-gray-400 text-sm mb-2">Moyenne/Jour</p>
      <p id="dailyAverage" class="text-3xl font-bold text-white glow-text">0 DH</p>
      <div class="text-xs text-gray-500 mt-1">
        <i class="fas fa-calendar-day text-yellow-400"></i>
        <span id="dailyForecast">Pr√©vision</span>
      </div>
    </div>
  </section>

  <!-- ALERTES INTELLIGENTES PREMIUM -->
  <section id="alertsContainer" class="space-y-3"></section>

  <!-- GRAPHIQUES AM√âLIOR√âS PREMIUM -->
  <section class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div class="premium-card rounded-2xl p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-semibold text-white flex items-center">
          <i class="fas fa-chart-pie mr-3 text-purple-400"></i>
          R√©partition par cat√©gorie
        </h2>
        <div class="flex space-x-2">
          <div class="w-3 h-3 bg-gradient-to-r from-purple-400 to-pink-400 rounded-full animate-pulse"></div>
        </div>
      </div>
      <canvas id="pieChart" class="max-h-64"></canvas>
    </div>
    
    <div class="premium-card rounded-2xl p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-semibold text-white flex items-center">
          <i class="fas fa-chart-bar mr-3 text-yellow-400"></i>
          Top Cat√©gories
        </h2>
        <button id="categoryInsights" class="glass glass-hover px-3 py-1 rounded-lg text-xs text-white">
          <i class="fas fa-brain mr-1"></i>Insights
        </button>
      </div>
      <canvas id="barChart" class="max-h-64"></canvas>
    </div>
  </section>

  <section class="premium-card rounded-2xl p-6">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-xl font-semibold text-white flex items-center">
        <i class="fas fa-chart-line mr-3 text-green-400"></i>
        Analyse Pr√©dictive IA
      </h2>
      <div class="flex space-x-2">
        <button id="predictiveMode" class="glass glass-hover px-3 py-1 rounded-lg text-xs text-white">
          <i class="fas fa-crystal-ball mr-1"></i>Pr√©diction
        </button>
        <button id="compareMode" class="glass glass-hover px-3 py-1 rounded-lg text-xs text-white">
          <i class="fas fa-balance-scale mr-1"></i>Comparer
        </button>
      </div>
    </div>
    <canvas id="trendChart" class="max-h-64"></canvas>
  </section>

  <!-- WIDGETS R√âVOLUTIONNAIRES -->
  <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Widget Objectifs -->
    <div class="premium-card rounded-2xl p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-white flex items-center">
          <i class="fas fa-bullseye mr-2 text-green-400"></i>
          Objectifs
        </h3>
        <button id="addGoalBtn" class="glass glass-hover p-2 rounded-lg">
          <i class="fas fa-plus text-white"></i>
        </button>
      </div>
      <div id="goalsList" class="space-y-3"></div>
    </div>
    
    <!-- Widget Abonnements -->
    <div class="premium-card rounded-2xl p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-white flex items-center">
          <i class="fas fa-sync-alt mr-2 text-blue-400"></i>
          Abonnements
        </h3>
        <button id="addSubscriptionBtn" class="glass glass-hover p-2 rounded-lg">
          <i class="fas fa-plus text-white"></i>
        </button>
      </div>
      <div id="subscriptionsList" class="space-y-3"></div>
    </div>
    
    <!-- Widget √âconomies -->
    <div class="premium-card rounded-2xl p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-white flex items-center">
          <i class="fas fa-leaf mr-2 text-green-400"></i>
          √âconomies IA
        </h3>
        <div class="text-xs text-green-400">+127 DH ce mois</div>
      </div>
      <div id="savingsInsights" class="space-y-2">
        <div class="text-sm text-gray-300">
          <i class="fas fa-lightbulb text-yellow-400 mr-2"></i>
          R√©duisez vos sorties restaurant de 20%
        </div>
        <div class="text-sm text-gray-300">
          <i class="fas fa-car text-blue-400 mr-2"></i>
          Covoiturage: -45 DH/semaine possible
        </div>
      </div>
    </div>
  </section>

  <!-- LISTE DES D√âPENSES PREMIUM -->
  <section class="premium-card rounded-2xl p-6">
    <div class="flex items-center justify-between mb-6">
      <h3 class="text-xl font-semibold text-white flex items-center">
        <i class="fas fa-list mr-3 text-purple-400"></i>
        Transactions r√©centes
      </h3>
      <div class="flex space-x-2">
        <div class="relative">
          <input type="text" id="searchExpenses" placeholder="Rechercher..."
                 class="bg-black/30 border border-white/20 rounded-lg px-8 py-2 text-white text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
          <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
        </div>
        <button id="sortByAmount" class="glass glass-hover px-3 py-2 rounded-lg text-sm text-white">
          <i class="fas fa-sort-amount-down mr-1"></i>Montant
        </button>
        <button id="sortByDate" class="glass glass-hover px-3 py-2 rounded-lg text-sm text-white">
          <i class="fas fa-sort-numeric-down mr-1"></i>Date
        </button>
        <button id="filterBtn" class="glass glass-hover px-3 py-2 rounded-lg text-sm text-white">
          <i class="fas fa-filter mr-1"></i>Filtrer
        </button>
      </div>
    </div>
    <div id="expensesList" class="space-y-3 max-h-96 overflow-y-auto custom-scrollbar"></div>
  </section>

</main>

<!-- BOUTON FLOTTANT R√âVOLUTIONNAIRE -->
<div class="fixed bottom-6 right-6 z-40">
  <div class="relative">
    <!-- Menu flottant -->
    <div id="floatingMenu" class="absolute bottom-16 right-0 space-y-3 hidden">
      <button id="quickPhotoBtn" class="glass glass-hover w-12 h-12 rounded-full flex items-center justify-center text-white">
        <i class="fas fa-camera"></i>
      </button>
      <button id="voiceExpenseBtn" class="glass glass-hover w-12 h-12 rounded-full flex items-center justify-center text-white">
        <i class="fas fa-microphone"></i>
      </button>
      <button id="aiSuggestBtn" class="glass glass-hover w-12 h-12 rounded-full flex items-center justify-center text-white">
        <i class="fas fa-magic"></i>
      </button>
    </div>
    
    <!-- Bouton principal -->
    <button id="addExpenseBtn" class="w-16 h-16 btn-premium rounded-full shadow-2xl flex items-center justify-center text-white text-2xl relative overflow-hidden">
      <i id="mainFloatingIcon" class="fas fa-plus transition-transform duration-300"></i>
    </button>
  </div>
</div>

<!-- MODAL AJOUTER D√âPENSE R√âVOLUTIONNAIRE -->
<div id="modalAdd" class="hidden fixed inset-0 modal-backdrop flex justify-center items-center z-50">
  <div class="glass rounded-3xl p-8 w-[480px] max-w-[90vw] relative overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-br from-purple-500/5 to-yellow-500/5"></div>
    
    <div class="relative text-center mb-6">
      <div class="icon-container mx-auto mb-4">
        <i class="fas fa-plus text-2xl"></i>
      </div>
      <h2 class="text-2xl font-bold text-white glow-text">Nouvelle d√©pense</h2>
      <p class="text-gray-300 text-sm mt-1">Ajoutez une transaction intelligente</p>
    </div>
    
    <form id="expenseForm" class="space-y-6 relative">
      <!-- Onglets de saisie -->
      <div class="flex space-x-1 bg-black/20 rounded-xl p-1 mb-6">
        <button type="button" id="manualTab" class="flex-1 py-2 px-4 rounded-lg text-white text-sm font-medium transition-all bg-white/20">
          <i class="fas fa-keyboard mr-2"></i>Manuel
        </button>
        <button type="button" id="voiceTab" class="flex-1 py-2 px-4 rounded-lg text-gray-400 text-sm font-medium transition-all">
          <i class="fas fa-microphone mr-2"></i>Vocal
        </button>
        <button type="button" id="photoTab" class="flex-1 py-2 px-4 rounded-lg text-gray-400 text-sm font-medium transition-all">
          <i class="fas fa-camera mr-2"></i>Photo
        </button>
      </div>
      
      <!-- Saisie manuelle -->
      <div id="manualInput" class="space-y-4">
        <div class="smart-input">
          <div class="relative">
            <i class="fas fa-file-alt absolute left-4 top-1/2 transform -translate-y-1/2 text-purple-400"></i>
            <input type="text" id="expDesc" placeholder="Description de la d√©pense" 
                   class="w-full pl-12 pr-12 py-4 bg-black/30 border border-white/20 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all" required/>
            <button type="button" id="aiDescSuggest" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-yellow-400">
              <i class="fas fa-magic"></i>
            </button>
          </div>
        </div>
        
        <div class="smart-input">
          <div class="relative">
            <i class="fas fa-coins absolute left-4 top-1/2 transform -translate-y-1/2 text-yellow-400"></i>
            <input type="number" id="expAmount" placeholder="Montant (DH)" step="0.01" 
                   class="w-full pl-12 pr-4 py-4 bg-black/30 border border-white/20 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all" required/>
          </div>
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div class="relative">
            <i class="fas fa-tags absolute left-4 top-1/2 transform -translate-y-1/2 text-blue-400"></i>
            <select id="expCategory" 
                    class="w-full pl-12 pr-4 py-4 bg-black/30 border border-white/20 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none">
              <option value="Alimentation">üçï Alimentation</option>
              <option value="Transport">üöó Transport</option>
              <option value="Loisirs">üéÆ Loisirs</option>
              <option value="Sant√©">üè• Sant√©</option>
              <option value="Shopping">üõçÔ∏è Shopping</option>
              <option value="Logement">üè† Logement</option>
              <option value="√âducation">üìö √âducation</option>
              <option value="Voyage">‚úàÔ∏è Voyage</option>
              <option value="Sport">‚öΩ Sport</option>
              <option value="Beaut√©">üíÑ Beaut√©</option>
              <option value="Technologie">üì± Technologie</option>
              <option value="Autres">‚≠ê Autres</option>
            </select>
          </div>
          
          <div class="relative">
            <i class="fas fa-calendar absolute left-4 top-1/2 transform -translate-y-1/2 text-green-400"></i>
            <input type="date" id="expDate" 
                   class="w-full pl-12 pr-4 py-4 bg-black/30 border border-white/20 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-green-500"/>
          </div>
        </div>
        
        <!-- Tags personnalis√©s -->
        <div class="space-y-2">
          <label class="text-white text-sm font-medium">Tags (optionnel)</label>
          <div class="flex flex-wrap gap-2" id="tagContainer">
            <input type="text" id="tagInput" placeholder="Ajouter un tag..." 
                   class="bg-black/30 border border-white/20 rounded-lg px-3 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-purple-500">
          </div>
        </div>
        
        <!-- G√©olocalisation -->
        <div class="flex items-center space-x-3">
          <button type="button" id="locationBtn" class="glass glass-hover px-4 py-2 rounded-lg text-white text-sm">
            <i class="fas fa-map-marker-alt mr-2"></i>Ajouter localisation
          </button>
          <span id="locationText" class="text-gray-400 text-sm hidden"></span>
        </div>
      </div>
      
      <!-- Saisie vocale -->
      <div id="voiceInput" class="hidden text-center py-8">
        <div class="voice-wave mb-4">
          <span></span><span></span><span></span><span></span>
        </div>
        <button type="button" id="startVoiceRecord" class="btn-premium w-20 h-20 rounded-full">
          <i class="fas fa-microphone text-2xl"></i>
        </button>
        <p class="text-white mt-4">Appuyez et parlez</p>
        <p class="text-gray-400 text-sm">Ex: "25 dirhams restaurant McDo"</p>
      </div>
      
      <!-- Saisie photo -->
      <div id="photoInput" class="hidden text-center py-8">
        <div class="border-2 border-dashed border-white/20 rounded-xl p-8 mb-4">
          <input type="file" id="receiptPhoto" accept="image/*" class="hidden">
          <button type="button" id="takePhoto" class="btn-premium w-20 h-20 rounded-full">
            <i class="fas fa-camera text-2xl"></i>
          </button>
          <p class="text-white mt-4">Photographier un re√ßu</p>
          <p class="text-gray-400 text-sm">L'IA extraira automatiquement les informations</p>
        </div>
        <div id="photoPreview" class="hidden">
          <img id="previewImg" class="max-w-full h-32 object-cover rounded-lg mx-auto">
          <div id="extractedData" class="mt-4 p-4 bg-green-500/20 rounded-lg border border-green-400/30">
            <p class="text-green-300 text-sm">‚úÖ Donn√©es extraites par l'IA</p>
          </div>
        </div>
      </div>
      
      <!-- Boutons d'action -->
      <div class="flex space-x-3">
        <button type="button" id="closeModal" 
                class="flex-1 glass glass-hover text-white px-6 py-4 rounded-xl transition-all duration-300">
          Annuler
        </button>
        <button type="submit" id="saveExpense" 
                class="flex-1 btn-premium text-white px-6 py-4 rounded-xl font-semibold">
          <i class="fas fa-save mr-2"></i>
          Ajouter
        </button>
      </div>
    </form>
  </div>
</div>

<!-- MODAL ANALYTICS IA -->
<div id="analyticsModal" class="hidden fixed inset-0 modal-backdrop flex justify-center items-center z-50">
  <div class="glass rounded-3xl p-8 w-[600px] max-w-[90vw] relative">
    <div class="text-center mb-6">
      <div class="icon-container mx-auto mb-4">
        <i class="fas fa-brain text-2xl"></i>
      </div>
      <h2 class="text-2xl font-bold text-white">Analytics IA</h2>
      <p class="text-gray-300 text-sm">Analyse intelligente de vos d√©penses</p>
    </div>
    
    <div id="analyticsContent" class="space-y-6">
      <!-- Contenu dynamique g√©n√©r√© par l'IA -->
    </div>
    
    <button id="closeAnalytics" class="w-full mt-6 glass glass-hover text-white px-6 py-3 rounded-xl">
      Fermer
    </button>
  </div>
</div>

<script>
class PremiumExpenseTracker {
  constructor() {
    this.currentUser = null;
    this.expenses = [];
    this.budget = 2000;
    this.threshold = this.budget;
    this.currentMonthKey = new Date().toISOString().slice(0, 7);
    this.goals = [];
    this.subscriptions = [];
    this.userLocation = null;
    this.voiceRecognition = null;
    this.currentTab = 'manual';
    this.isFloatingMenuOpen = false;
    this.tags = [];
    
    this.initializeElements();
    this.initializeCharts();
    this.bindEvents();
    this.setupVoiceRecognition();
    this.checkLoginStatus();
  }

  initializeElements() {
    this.elements = {
      userDisplay: document.getElementById("userDisplay"),
      totalExpenses: document.getElementById("totalExpenses"),
      remainingBudget: document.getElementById("remainingBudget"),
      totalTransactions: document.getElementById("totalTransactions"),
      dailyAverage: document.getElementById("dailyAverage"),
      budgetPercentage: document.getElementById("budgetPercentage"),
      progressCircle: document.getElementById("progressCircle"),
      alertsContainer: document.getElementById("alertsContainer"),
      expensesList: document.getElementById("expensesList"),
      monthSelect: document.getElementById("monthSelect"),
      notification: document.getElementById("notification"),
      aiSuggestions: document.getElementById("aiSuggestions"),
      suggestionsList: document.getElementById("suggestionsList"),
      budgetUsed: document.getElementById("budgetUsed"),
      expenseChange: document.getElementById("expenseChange"),
      budgetHealth: document.getElementById("budgetHealth"),
      transactionTrend: document.getElementById("transactionTrend"),
      dailyForecast: document.getElementById("dailyForecast")
    };
    
    // Set current month as default
    this.elements.monthSelect.value = this.currentMonthKey;
  }

  initializeCharts() {
    Chart.defaults.color = '#ffffff';
    Chart.defaults.borderColor = 'rgba(255,255,255,0.1)';
    
    const chartOptions = {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'bottom',
          labels: { 
            usePointStyle: true, 
            padding: 20,
            color: '#ffffff'
          }
        }
      }
    };

    // Graphique en secteurs avec d√©grad√©s
    this.pieChart = new Chart(document.getElementById("pieChart"), {
      type: 'doughnut',
      data: {
        labels: [],
        datasets: [{
          data: [],
          backgroundColor: [
            'rgba(139, 92, 246, 0.8)',
            'rgba(245, 158, 11, 0.8)',
            'rgba(16, 185, 129, 0.8)',
            'rgba(239, 68, 68, 0.8)',
            'rgba(59, 130, 246, 0.8)',
            'rgba(236, 72, 153, 0.8)',
            'rgba(34, 197, 94, 0.8)',
            'rgba(168, 85, 247, 0.8)'
          ],
          borderWidth: 0,
          cutout: '65%'
        }]
      },
      options: chartOptions
    });

    this.barChart = new Chart(document.getElementById("barChart"), {
      type: 'bar',
      data: {
        labels: [],
        datasets: [{
          data: [],
          backgroundColor: 'rgba(139, 92, 246, 0.8)',
          borderRadius: 8,
          borderSkipped: false
        }]
      },
      options: {
        ...chartOptions,
        indexAxis: 'y',
        scales: {
          x: { 
            beginAtZero: true, 
            grid: { color: 'rgba(255,255,255,0.1)' },
            ticks: { color: '#ffffff' }
          },
          y: { 
            grid: { display: false },
            ticks: { color: '#ffffff' }
          }
        }
      }
    });

    this.trendChart = new Chart(document.getElementById("trendChart"), {
      type: 'line',
      data: {
        labels: [],
        datasets: [
          {
            label: "D√©penses R√©elles",
            data: [],
            borderColor: 'rgba(239, 68, 68, 1)',
            backgroundColor: 'rgba(239, 68, 68, 0.1)',
            fill: true,
            tension: 0.4,
            pointRadius: 6,
            pointHoverRadius: 8
          },
          {
            label: "Pr√©diction IA",
            data: [],
            borderColor: 'rgba(139, 92, 246, 1)',
            backgroundColor: 'rgba(139, 92, 246, 0.1)',
            fill: false,
            tension: 0.4,
            borderDash: [5, 5]
          }
        ]
      },
      options: {
        ...chartOptions,
        scales: {
          y: { 
            beginAtZero: true, 
            grid: { color: 'rgba(255,255,255,0.1)' },
            ticks: { color: '#ffffff' }
          },
          x: { 
            grid: { color: 'rgba(255,255,255,0.1)' },
            ticks: { color: '#ffffff' }
          }
        }
      }
    });
  }

  bindEvents() {
    this.setupAdvancedLoginSystem();
    
    // Boutons principaux
    document.getElementById("addExpenseBtn").onclick = () => this.toggleFloatingMenu();
    document.getElementById("closeModal").onclick = () => this.hideModal();
    document.getElementById("expenseForm").onsubmit = (e) => this.saveExpense(e);
    
    // Onglets du modal
    document.getElementById("manualTab").onclick = () => this.switchTab('manual');
    document.getElementById("voiceTab").onclick = () => this.switchTab('voice');
    document.getElementById("photoTab").onclick = () => this.switchTab('photo');
    
    // Header buttons
    document.getElementById("voiceBtn").onclick = () => this.toggleVoiceCommand();
    document.getElementById("aiBtn").onclick = () => this.showAIInsights();
    document.getElementById("settingsBtn").onclick = () => this.toggleSettingsDropdown();
    document.getElementById("logoutBtn").onclick = () => this.logout();
    
    // Settings menu
    document.getElementById("thresholdBtn").onclick = () => this.changeBudget();
    document.getElementById("exportBtn").onclick = () => this.exportData();
    document.getElementById("backupBtn").onclick = () => this.backupData();
    document.getElementById("analyticsBtn").onclick = () => this.openAnalytics();
    document.getElementById("resetBtn").onclick = () => this.resetData();
    
    // Month controls
    document.getElementById("monthSelect").onchange = (e) => this.changeMonth(e.target.value);
    document.getElementById("goCurrentMonth").onclick = () => this.goToCurrentMonth();
    
    // Menu flottant
    document.getElementById("quickPhotoBtn").onclick = () => this.quickPhotoExpense();
    document.getElementById("voiceExpenseBtn").onclick = () => this.quickVoiceExpense();
    document.getElementById("aiSuggestBtn").onclick = () => this.showAISuggestions();
    
    // G√©olocalisation
    document.getElementById("locationBtn").onclick = () => this.addLocation();
    
    // Photo et reconnaissance
    document.getElementById("takePhoto").onclick = () => document.getElementById("receiptPhoto").click();
    document.getElementById("receiptPhoto").onchange = (e) => this.processReceipt(e);
    
    // Recherche et filtres
    document.getElementById("searchExpenses").oninput = (e) => this.searchExpenses(e.target.value);
    document.getElementById("filterBtn").onclick = () => this.showFilterOptions();
    document.getElementById("sortByAmount").onclick = () => this.sortExpenses('amount');
    document.getElementById("sortByDate").onclick = () => this.sortExpenses('date');
    
    // Tags
    document.getElementById("tagInput").onkeydown = (e) => {
      if (e.key === 'Enter' && e.target.value.trim()) {
        this.addTag(e.target.value.trim());
        e.target.value = '';
        e.preventDefault();
      }
    };
    
    // AI features
    document.getElementById("aiDescSuggest").onclick = () => this.suggestDescription();
    document.getElementById("startVoiceRecord").onclick = () => this.startVoiceRecording();
    document.getElementById("categoryInsights").onclick = () => this.showCategoryInsights();
    document.getElementById("predictiveMode").onclick = () => this.enablePredictiveMode();
    document.getElementById("compareMode").onclick = () => this.enableCompareMode();
    
    // Suggestions and notifications
    document.getElementById("closeSuggestions").onclick = () => this.hideSuggestions();
    document.getElementById("closeNotification").onclick = () => this.hideNotification();
    document.getElementById("closeAnalytics").onclick = () => this.closeAnalytics();
    
    // Date par d√©faut
    document.getElementById("expDate").valueAsDate = new Date();
    
    // Fermer modals en cliquant √† l'ext√©rieur
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal-backdrop')) {
        this.hideModal();
        this.closeAnalytics();
        document.getElementById("forgotPasswordModal").classList.add("hidden");
      }
    });
  }

  setupAdvancedLoginSystem() {
    let mode = "login";
    const securityQuestions = {
      pet: "Quel √©tait le nom de votre premier animal de compagnie ?",
      school: "Dans quelle √©cole primaire avez-vous √©tudi√© ?",
      mother: "Quel est le nom de jeune fille de votre m√®re ?",
      city: "Dans quelle ville √™tes-vous n√©(e) ?",
      friend: "Quel est le pr√©nom de votre meilleur ami d'enfance ?"
    };
    
    // Basculer entre connexion et inscription
    document.getElementById("btnLogin").onclick = () => {
      mode = "login";
      this.updateLoginUI(mode);
    };
    
    document.getElementById("btnRegister").onclick = () => {
      mode = "register";
      this.updateLoginUI(mode);
    };
    
    // Mot de passe oubli√©
    document.getElementById("btnForgotPassword").onclick = () => {
      document.getElementById("forgotPasswordModal").classList.remove("hidden");
    };
    
    document.getElementById("closeForgotModal").onclick = () => {
      document.getElementById("forgotPasswordModal").classList.add("hidden");
    };
    
    // Toggle password visibility
    document.getElementById("togglePassword").onclick = () => {
      const passwordField = document.getElementById("password");
      const icon = document.querySelector("#togglePassword i");
      
      if (passwordField.type === "password") {
        passwordField.type = "text";
        icon.className = "fas fa-eye-slash";
      } else {
        passwordField.type = "password";
        icon.className = "fas fa-eye";
      }
    };
    
    // Authentification biom√©trique simul√©e
    document.getElementById("biometricBtn").onclick = () => {
      this.simulateBiometricAuth();
    };
    
    // Formulaire principal
    document.getElementById("loginForm").onsubmit = (e) => {
      e.preventDefault();
      this.handleLogin(mode);
    };
    
    // R√©cup√©ration mot de passe
    document.getElementById("forgotPasswordForm").onsubmit = (e) => {
      e.preventDefault();
      this.handlePasswordRecovery();
    };
    
    // Affichage question de s√©curit√©
    document.getElementById("forgotUsername").onblur = () => {
      const username = document.getElementById("forgotUsername").value;
      if (username) {
        this.showSecurityQuestion(username);
      }
    };
  }

  updateLoginUI(mode) {
    const formTitle = document.getElementById("formTitle");
    const submitBtn = document.getElementById("submitBtn");
    const thresholdContainer = document.getElementById("maxThresholdContainer");
    const securityContainer = document.getElementById("securityQuestionContainer");
    const biometricAuth = document.getElementById("biometricAuth");
    
    if (mode === "login") {
      formTitle.textContent = "Connexion S√©curis√©e";
      submitBtn.innerHTML = '<i class="fas fa-sign-in-alt mr-2"></i>Se connecter';
      thresholdContainer.classList.add("hidden");
      securityContainer.classList.add("hidden");
      biometricAuth.classList.remove("hidden");
    } else {
      formTitle.textContent = "Inscription Premium";
      submitBtn.innerHTML = '<i class="fas fa-user-plus mr-2"></i>S\'inscrire';
      thresholdContainer.classList.remove("hidden");
      securityContainer.classList.remove("hidden");
      biometricAuth.classList.add("hidden");
    }
  }

  handleLogin(mode) {
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;
    
    if (mode === "login") {
      // V√©rifier les identifiants
      const userData = JSON.parse(localStorage.getItem(`user_${username}`) || '{}');
      if (userData.password === password) {
        this.currentUser = username;
        this.budget = userData.budget || 2000;
        this.threshold = this.budget;
        this.loginSuccess();
      } else {
        this.showNotification("Erreur", "Identifiants incorrects", "error");
      }
    } else {
      // Inscription
      const budget = parseFloat(document.getElementById("maxThreshold").value) || 2000;
      const securityQuestion = document.getElementById("securityQuestion").value;
      const securityAnswer = document.getElementById("securityAnswer").value;
      
      if (!securityQuestion || !securityAnswer) {
        this.showNotification("Erreur", "Veuillez compl√©ter la question de s√©curit√©", "error");
        return;
      }
      
      const userData = {
        password: password,
        budget: budget,
        securityQuestion: securityQuestion,
        securityAnswer: securityAnswer.toLowerCase(),
        createdAt: new Date().toISOString()
      };
      
      localStorage.setItem(`user_${username}`, JSON.stringify(userData));
      this.currentUser = username;
      this.budget = budget;
      this.threshold = this.budget;
      this.loginSuccess();
    }
  }

  simulateBiometricAuth() {
    const biometricBtn = document.getElementById("biometricBtn");
    biometricBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Scan en cours...';
    
    setTimeout(() => {
      // Simuler succ√®s biom√©trique
      this.currentUser = "BiometricUser";
      this.budget = 2000;
      this.threshold = this.budget;
      this.loginSuccess();
    }, 2000);
  }

  showSecurityQuestion(username) {
    const userData = JSON.parse(localStorage.getItem(`user_${username}`) || '{}');
    if (userData.securityQuestion) {
      const questions = {
        pet: "Quel √©tait le nom de votre premier animal de compagnie ?",
        school: "Dans quelle √©cole primaire avez-vous √©tudi√© ?",
        mother: "Quel est le nom de jeune fille de votre m√®re ?",
        city: "Dans quelle ville √™tes-vous n√©(e) ?",
        friend: "Quel est le pr√©nom de votre meilleur ami d'enfance ?"
      };
      
      document.getElementById("questionText").textContent = questions[userData.securityQuestion];
      document.getElementById("securityQuestionDisplay").classList.remove("hidden");
      document.getElementById("securityAnswerContainer").classList.remove("hidden");
    }
  }

  handlePasswordRecovery() {
    const username = document.getElementById("forgotUsername").value;
    const answer = document.getElementById("forgotSecurityAnswer").value.toLowerCase();
    
    const userData = JSON.parse(localStorage.getItem(`user_${username}`) || '{}');
    if (userData.securityAnswer === answer) {
      this.showNotification("Succ√®s", `Votre mot de passe est: ${userData.password}`, "success");
      document.getElementById("forgotPasswordModal").classList.add("hidden");
    } else {
      this.showNotification("Erreur", "R√©ponse incorrecte", "error");
    }
  }

  loginSuccess() {
    this.elements.userDisplay.textContent = this.currentUser;
    document.getElementById("loginScreen").classList.add("hidden");
    this.loadUserData();
    this.showNotification("Bienvenue", `Connexion r√©ussie ${this.currentUser}!`, "success");
    this.generateAISuggestions();
  }

  logout() {
    this.currentUser = null;
    this.expenses = [];
    document.getElementById("loginScreen").classList.remove("hidden");
    this.updateDisplay();
  }

  checkLoginStatus() {
    // Si d√©j√† connect√© (pour les tests)
    if (!this.currentUser) {
      document.getElementById("loginScreen").classList.remove("hidden");
    } else {
      this.loadUserData();
    }
  }

  loadUserData() {
    if (!this.currentUser) return;
    
    const userKey = `${this.currentUser}_${this.currentMonthKey}`;
    const savedExpenses = localStorage.getItem(userKey);
    if (savedExpenses) {
      this.expenses = JSON.parse(savedExpenses);
    }
    
    const userData = JSON.parse(localStorage.getItem(`user_${this.currentUser}`) || '{}');
    if (userData.budget) {
      this.budget = userData.budget;
      this.threshold = this.budget;
    }
    
    this.updateDisplay();
    this.updateCharts();
  }

  saveExpense(e) {
    e.preventDefault();
    
    if (this.currentTab === 'manual') {
      const desc = document.getElementById("expDesc").value;
      const amount = parseFloat(document.getElementById("expAmount").value);
      const category = document.getElementById("expCategory").value;
      const date = document.getElementById("expDate").value;
      
      if (!desc || !amount || amount <= 0) {
        this.showNotification("Erreur", "Veuillez remplir tous les champs correctement", "error");
        return;
      }
      
      const expense = {
        id: Date.now(),
        description: desc,
        amount: amount,
        category: category,
        date: date,
        tags: [...this.tags],
        location: this.userLocation,
        timestamp: new Date().toISOString()
      };
      
      this.expenses.unshift(expense);
      this.saveData();
      this.updateDisplay();
      this.updateCharts();
      this.hideModal();
      this.resetForm();
      
      this.showNotification("Succ√®s", `D√©pense de ${amount} DH ajout√©e`, "success");
      this.checkBudgetAlerts(amount);
    }
  }

  resetForm() {
    document.getElementById("expenseForm").reset();
    document.getElementById("expDate").valueAsDate = new Date();
    this.tags = [];
    this.userLocation = null;
    document.getElementById("tagContainer").innerHTML = '<input type="text" id="tagInput" placeholder="Ajouter un tag..." class="bg-black/30 border border-white/20 rounded-lg px-3 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-purple-500">';
    document.getElementById("locationText").classList.add("hidden");
    this.rebindTagEvents();
  }

  rebindTagEvents() {
    document.getElementById("tagInput").onkeydown = (e) => {
      if (e.key === 'Enter' && e.target.value.trim()) {
        this.addTag(e.target.value.trim());
        e.target.value = '';
        e.preventDefault();
      }
    };
  }

  addTag(tag) {
    if (!this.tags.includes(tag)) {
      this.tags.push(tag);
      this.updateTagDisplay();
    }
  }

  updateTagDisplay() {
    const container = document.getElementById("tagContainer");
    const tagElements = this.tags.map(tag => 
      `<span class="tag-item">
        ${tag}
        <i class="fas fa-times cursor-pointer ml-1" onclick="tracker.removeTag('${tag}')"></i>
      </span>`
    ).join('');
    
    container.innerHTML = tagElements + 
      '<input type="text" id="tagInput" placeholder="Ajouter un tag..." class="bg-black/30 border border-white/20 rounded-lg px-3 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-purple-500">';
    
    this.rebindTagEvents();
  }

  removeTag(tag) {
    this.tags = this.tags.filter(t => t !== tag);
    this.updateTagDisplay();
  }

  switchTab(tab) {
    this.currentTab = tab;
    
    // Reset tab buttons
    document.querySelectorAll('#modalAdd button[id$="Tab"]').forEach(btn => {
      btn.classList.remove('bg-white/20');
      btn.classList.add('text-gray-400');
    });
    
    // Hide all inputs
    document.getElementById('manualInput').classList.add('hidden');
    document.getElementById('voiceInput').classList.add('hidden');
    document.getElementById('photoInput').classList.add('hidden');
    
    // Show selected tab
    document.getElementById(`${tab}Tab`).classList.add('bg-white/20');
    document.getElementById(`${tab}Tab`).classList.remove('text-gray-400');
    document.getElementById(`${tab}Input`).classList.remove('hidden');
  }

  toggleFloatingMenu() {
    const menu = document.getElementById("floatingMenu");
    const icon = document.getElementById("mainFloatingIcon");
    
    if (this.isFloatingMenuOpen) {
      menu.classList.add("hidden");
      icon.style.transform = "rotate(0deg)";
      this.isFloatingMenuOpen = false;
    } else {
      menu.classList.remove("hidden");
      icon.style.transform = "rotate(45deg)";
      this.isFloatingMenuOpen = true;
    }
  }

  showModal() {
    document.getElementById("modalAdd").classList.remove("hidden");
    this.switchTab('manual');
  }

  hideModal() {
    document.getElementById("modalAdd").classList.add("hidden");
    if (this.isFloatingMenuOpen) {
      this.toggleFloatingMenu();
    }
  }

  toggleSettingsDropdown() {
    const dropdown = document.getElementById("settingsDropdown");
    dropdown.classList.toggle("hidden");
  }

  changeMonth(monthKey) {
    this.currentMonthKey = monthKey;
    this.loadUserData();
  }

  goToCurrentMonth() {
    const currentMonth = new Date().toISOString().slice(0, 7);
    this.elements.monthSelect.value = currentMonth;
    this.changeMonth(currentMonth);
  }

  updateDisplay() {
    const total = this.expenses.reduce((sum, exp) => sum + exp.amount, 0);
    const remaining = Math.max(0, this.threshold - total);
    const percentage = this.threshold > 0 ? Math.min(100, (total / this.threshold) * 100) : 0;
    
    this.elements.totalExpenses.textContent = `${total.toFixed(2)} DH`;
    this.elements.remainingBudget.textContent = `${remaining.toFixed(2)} DH`;
    this.elements.totalTransactions.textContent = this.expenses.length;
    this.elements.budgetUsed.textContent = `${total.toFixed(2)} DH`;
    this.elements.budgetPercentage.textContent = `${Math.round(percentage)}%`;
    
    // Calcul moyenne quotidienne
    const daysInMonth = new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).getDate();
    const dailyAvg = this.expenses.length > 0 ? total / daysInMonth : 0;
    this.elements.dailyAverage.textContent = `${dailyAvg.toFixed(2)} DH`;
    
    // Mise √† jour du cercle de progression
    const circumference = 2 * Math.PI * 25;
    const offset = circumference - (percentage / 100) * circumference;
    this.elements.progressCircle.style.strokeDashoffset = offset;
    
    // Indicateurs de sant√©
    if (percentage > 90) {
      this.elements.budgetHealth.textContent = "Critique";
      this.elements.budgetHealth.className = "text-red-400";
    } else if (percentage > 75) {
      this.elements.budgetHealth.textContent = "Attention";
      this.elements.budgetHealth.className = "text-yellow-400";
    } else {
      this.elements.budgetHealth.textContent = "Sain";
      this.elements.budgetHealth.className = "text-green-400";
    }
    
    this.updateExpensesList();
    this.updateAlerts();
  }

  updateExpensesList() {
    if (this.expenses.length === 0) {
      this.elements.expensesList.innerHTML = `
        <div class="text-center py-8">
          <i class="fas fa-inbox text-4xl text-gray-600 mb-4"></i>
          <p class="text-gray-400">Aucune d√©pense pour ce mois</p>
          <button onclick="tracker.showModal()" class="mt-4 btn-premium px-6 py-2 rounded-lg text-white">
            <i class="fas fa-plus mr-2"></i>Ajouter une d√©pense
          </button>
        </div>
      `;
      return;
    }
    
    this.elements.expensesList.innerHTML = this.expenses.map(exp => {
      const date = new Date(exp.date).toLocaleDateString('fr-FR');
      const categoryIcon = this.getCategoryIcon(exp.category);
      const tags = exp.tags && exp.tags.length > 0 ? 
        exp.tags.map(tag => `<span class="tag-item text-xs">${tag}</span>`).join(' ') : '';
      
      return `
        <div class="expense-item premium-card rounded-xl p-4 transition-all">
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
              <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-purple-500/20 to-yellow-500/20 flex items-center justify-center">
                <span class="text-xl">${categoryIcon}</span>
              </div>
              <div>
                <h4 class="text-white font-medium">${exp.description}</h4>
                <p class="text-gray-400 text-sm">${exp.category} ‚Ä¢ ${date}</p>
                ${tags ? `<div class="flex gap-1 mt-1">${tags}</div>` : ''}
              </div>
            </div>
            <div class="text-right">
              <p class="text-xl font-bold text-white">${exp.amount.toFixed(2)} DH</p>
              <div class="flex space-x-2 mt-1">
                <button onclick="tracker.editExpense(${exp.id})" class="text-blue-400 hover:text-blue-300">
                  <i class="fas fa-edit"></i>
                </button>
                <button onclick="tracker.deleteExpense(${exp.id})" class="text-red-400 hover:text-red-300">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }).join('');
  }

  getCategoryIcon(category) {
    const icons = {
      'Alimentation': 'üçï',
      'Transport': 'üöó',
      'Loisirs': 'üéÆ',
      'Sant√©': 'üè•',
      'Shopping': 'üõçÔ∏è',
      'Logement': 'üè†',
      '√âducation': 'üìö',
      'Voyage': '‚úàÔ∏è',
      'Sport': '‚öΩ',
      'Beaut√©': 'üíÑ',
      'Technologie': 'üì±',
      'Autres': '‚≠ê'
    };
    return icons[category] || '‚≠ê';
  }

  updateAlerts() {
    const total = this.expenses.reduce((sum, exp) => sum + exp.amount, 0);
    const percentage = this.threshold > 0 ? (total / this.threshold) * 100 : 0;
    
    this.elements.alertsContainer.innerHTML = '';
    
    if (percentage > 90) {
      this.createAlert('Alerte Budget', 'Vous avez d√©pass√© 90% de votre budget!', 'error');
    } else if (percentage > 75) {
      this.createAlert('Attention', 'Vous approchez de la limite de budget', 'warning');
    }
    
    // Alerte d√©penses importantes
    const largeExpenses = this.expenses.filter(exp => exp.amount > this.threshold * 0.1);
    if (largeExpenses.length > 0) {
      this.createAlert('D√©penses importantes', `${largeExpenses.length} transaction(s) > 10% du budget`, 'info');
    }
  }

  createAlert(title, message, type) {
    const colors = {
      error: 'from-red-500/20 to-red-600/20 border-red-400/30',
      warning: 'from-yellow-500/20 to-yellow-600/20 border-yellow-400/30',
      info: 'from-blue-500/20 to-blue-600/20 border-blue-400/30'
    };
    
    const icons = {
      error: 'fa-exclamation-triangle text-red-400',
      warning: 'fa-exclamation-circle text-yellow-400',
      info: 'fa-info-circle text-blue-400'
    };
    
    const alertHtml = `
      <div class="premium-card rounded-xl p-4 bg-gradient-to-r ${colors[type]} border">
        <div class="flex items-center space-x-3">
          <i class="fas ${icons[type]}"></i>
          <div>
            <h4 class="text-white font-medium">${title}</h4>
            <p class="text-gray-300 text-sm">${message}</p>
          </div>
        </div>
      </div>
    `;
    
    this.elements.alertsContainer.insertAdjacentHTML('beforeend', alertHtml);
  }

  updateCharts() {
    this.updatePieChart();
    this.updateBarChart();
    this.updateTrendChart();
  }

  updatePieChart() {
    const categoryTotals = {};
    this.expenses.forEach(exp => {
      categoryTotals[exp.category] = (categoryTotals[exp.category] || 0) + exp.amount;
    });
    
    const labels = Object.keys(categoryTotals);
    const data = Object.values(categoryTotals);
    
    this.pieChart.data.labels = labels;
    this.pieChart.data.datasets[0].data = data;
    this.pieChart.update();
  }

  updateBarChart() {
    const categoryTotals = {};
    this.expenses.forEach(exp => {
      categoryTotals[exp.category] = (categoryTotals[exp.category] || 0) + exp.amount;
    });
    
    const sorted = Object.entries(categoryTotals)
      .sort(([,a], [,b]) => b - a)
      .slice(0, 5);
    
    const labels = sorted.map(([cat]) => cat);
    const data = sorted.map(([,amount]) => amount);
    
    this.barChart.data.labels = labels;
    this.barChart.data.datasets[0].data = data;
    this.barChart.update();
  }

  updateTrendChart() {
    // Cr√©er des donn√©es de tendance par jour
    const dailyTotals = {};
    this.expenses.forEach(exp => {
      const day = exp.date;
      dailyTotals[day] = (dailyTotals[day] || 0) + exp.amount;
    });
    
    const sortedDays = Object.keys(dailyTotals).sort();
    const realData = sortedDays.map(day => dailyTotals[day]);
    
    // Simulation de pr√©diction IA
    const predictedData = this.generatePrediction(realData);
    
    this.trendChart.data.labels = sortedDays;
    this.trendChart.data.datasets[0].data = realData;
    this.trendChart.data.datasets[1].data = predictedData;
    this.trendChart.update();
  }

  generatePrediction(realData) {
    if (realData.length < 2) return [];
    
    // Simple pr√©diction lin√©aire
    const lastValue = realData[realData.length - 1];
    const secondLastValue = realData[realData.length - 2];
    const trend = lastValue - secondLastValue;
    
    return realData.map((value, index) => {
      if (index < realData.length - 1) return null;
      return value + trend * 2; // Pr√©diction pour les 2 prochains jours
    });
  }

  searchExpenses(query) {
    if (!query) {
      this.updateExpensesList();
      return;
    }
    
    const filtered = this.expenses.filter(exp => 
      exp.description.toLowerCase().includes(query.toLowerCase()) ||
      exp.category.toLowerCase().includes(query.toLowerCase()) ||
      (exp.tags && exp.tags.some(tag => tag.toLowerCase().includes(query.toLowerCase())))
    );
    
    this.displayFilteredExpenses(filtered);
  }

  sortExpenses(type) {
    let sorted = [...this.expenses];
    
    if (type === 'amount') {
      sorted.sort((a, b) => b.amount - a.amount);
    } else if (type === 'date') {
      sorted.sort((a, b) => new Date(b.date) - new Date(a.date));
    }
    
    this.displayFilteredExpenses(sorted);
  }

  displayFilteredExpenses(expenses) {
    const originalExpenses = this.expenses;
    this.expenses = expenses;
    this.updateExpensesList();
    this.expenses = originalExpenses;
  }

  deleteExpense(id) {
    if (confirm('√ätes-vous s√ªr de vouloir supprimer cette d√©pense ?')) {
      this.expenses = this.expenses.filter(exp => exp.id !== id);
      this.saveData();
      this.updateDisplay();
      this.updateCharts();
      this.showNotification("Succ√®s", "D√©pense supprim√©e", "success");
    }
  }

  editExpense(id) {
    const expense = this.expenses.find(exp => exp.id === id);
    if (expense) {
      // Remplir le formulaire avec les donn√©es existantes
      document.getElementById("expDesc").value = expense.description;
      document.getElementById("expAmount").value = expense.amount;
      document.getElementById("expCategory").value = expense.category;
      document.getElementById("expDate").value = expense.date;
      
      // Supprimer l'ancienne d√©pense
      this.expenses = this.expenses.filter(exp => exp.id !== id);
      
      this.showModal();
    }
  }

  checkBudgetAlerts(amount) {
    const total = this.expenses.reduce((sum, exp) => sum + exp.amount, 0);
    const percentage = (total / this.threshold) * 100;
    
    if (percentage > 100) {
      this.showNotification("Budget D√©pass√©", "Vous avez d√©pass√© votre budget mensuel!", "error");
    } else if (percentage > 90) {
      this.showNotification("Alerte Budget", "Attention: 90% du budget utilis√©", "warning");
    }
  }

  showNotification(title, message, type = "info") {
    const icons = {
      success: "fa-check text-green-400",
      error: "fa-times text-red-400",
      warning: "fa-exclamation-triangle text-yellow-400",
      info: "fa-info-circle text-blue-400"
    };
    
    document.getElementById("notificationIcon").className = `fas ${icons[type]}`;
    document.getElementById("notificationTitle").textContent = title;
    document.getElementById("notificationText").textContent = message;
    
    this.elements.notification.classList.add("show");
    
    setTimeout(() => {
      this.hideNotification();
    }, 5000);
  }

  hideNotification() {
    this.elements.notification.classList.remove("show");
  }

  saveData() {
    if (this.currentUser) {
      const userKey = `${this.currentUser}_${this.currentMonthKey}`;
      localStorage.setItem(userKey, JSON.stringify(this.expenses));
    }
  }

  // Fonctionnalit√©s avanc√©es
  setupVoiceRecognition() {
    if ('webkitSpeechRecognition' in window) {
      this.voiceRecognition = new webkitSpeechRecognition();
      this.voiceRecognition.continuous = false;
      this.voiceRecognition.interimResults = false;
      this.voiceRecognition.lang = 'fr-FR';
      
      this.voiceRecognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        this.processVoiceInput(transcript);
      };
    }
  }

  toggleVoiceCommand() {
    const voiceWave = document.getElementById("voiceWave");
    const voiceIcon = document.getElementById("voiceIcon");
    
    if (this.voiceRecognition) {
      voiceWave.classList.remove("hidden");
      voiceIcon.classList.add("hidden");
      
      this.voiceRecognition.start();
      
      setTimeout(() => {
        voiceWave.classList.add("hidden");
        voiceIcon.classList.remove("hidden");
      }, 3000);
    }
  }

  processVoiceInput(transcript) {
    // Traitement basique de la commande vocale
    const matches = transcript.match(/(\d+).*?(dirhams?|DH).*?(\w+)/i);
    if (matches) {
      const amount = parseFloat(matches[1]);
      const description = transcript.replace(/(\d+).*?(dirhams?|DH)/i, '').trim();
      
      // Auto-remplir le formulaire
      document.getElementById("expAmount").value = amount;
      document.getElementById("expDesc").value = description;
      this.showModal();
    }
  }

  addLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition((position) => {
        this.userLocation = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        };
        document.getElementById("locationText").textContent = "üìç Position ajout√©e";
        document.getElementById("locationText").classList.remove("hidden");
      });
    }
  }

  processReceipt(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        document.getElementById("previewImg").src = e.target.result;
        document.getElementById("photoPreview").classList.remove("hidden");
        
        // Simulation d'extraction OCR
        setTimeout(() => {
          const mockData = {
            amount: Math.floor(Math.random() * 100) + 10,
            description: "Restaurant - Re√ßu scann√©",
            category: "Alimentation"
          };
          
          document.getElementById("expAmount").value = mockData.amount;
          document.getElementById("expDesc").value = mockData.description;
          document.getElementById("expCategory").value = mockData.category;
          
          this.switchTab('manual');
        }, 2000);
      };
      reader.readAsDataURL(file);
    }
  }

  generateAISuggestions() {
    const suggestions = [
      "üí° Vos d√©penses en transport ont augment√© de 15% ce mois",
      "üéØ Objectif possible: √âconomiser 200 DH sur les sorties",
      "üìä Votre meilleure cat√©gorie d'√©conomies: Alimentation",
      "‚ö° Conseil: Groupez vos courses pour √©conomiser sur le transport"
    ];
    
    this.elements.suggestionsList.innerHTML = suggestions.map(suggestion => 
      `<p class="text-gray-300 text-sm">${suggestion}</p>`
    ).join('');
    
    this.elements.aiSuggestions.classList.remove("hidden");
  }

  hideSuggestions() {
    this.elements.aiSuggestions.classList.add("hidden");
  }

  showAIInsights() {
    this.generateAISuggestions();
  }

  openAnalytics() {
    const modal = document.getElementById("analyticsModal");
    const content = document.getElementById("analyticsContent");
    
    // G√©n√©rer du contenu analytique
    const total = this.expenses.reduce((sum, exp) => sum + exp.amount, 0);
    const avgExpense = this.expenses.length > 0 ? total / this.expenses.length : 0;
    
    content.innerHTML = `
      <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="bg-purple-500/20 rounded-xl p-4 text-center">
          <h3 class="text-lg font-semibold text-white">D√©pense Moyenne</h3>
          <p class="text-2xl font-bold text-purple-400">${avgExpense.toFixed(2)} DH</p>
        </div>
        <div class="bg-yellow-500/20 rounded-xl p-4 text-center">
          <h3 class="text-lg font-semibold text-white">Pr√©diction Fin Mois</h3>
          <p class="text-2xl font-bold text-yellow-400">${(total * 1.3).toFixed(2)} DH</p>
        </div>
      </div>
      
      <div class="space-y-4">
        <h3 class="text-lg font-semibold text-white">üß† Insights IA</h3>
        <div class="bg-green-500/20 rounded-xl p-4">
          <p class="text-green-300">‚úÖ Votre gestion budg√©taire s'am√©liore (+12% vs mois dernier)</p>
        </div>
        <div class="bg-blue-500/20 rounded-xl p-4">
          <p class="text-blue-300">üìà Tendance: Diminution des d√©penses alimentaires (-8%)</p>
        </div>
        <div class="bg-yellow-500/20 rounded-xl p-4">
          <p class="text-yellow-300">‚ö†Ô∏è Attention: Augmentation des d√©penses loisirs (+25%)</p>
        </div>
      </div>
    `;
    
    modal.classList.remove("hidden");
  }

  closeAnalytics() {
    document.getElementById("analyticsModal").classList.add("hidden");
  }

  changeBudget() {
    const newBudget = prompt("Nouveau budget mensuel (DH):", this.budget);
    if (newBudget && !isNaN(newBudget) && newBudget > 0) {
      this.budget = parseFloat(newBudget);
      this.threshold = this.budget;
      
      // Sauvegarder dans les donn√©es utilisateur
      if (this.currentUser) {
        const userData = JSON.parse(localStorage.getItem(`user_${this.currentUser}`) || '{}');
        userData.budget = this.budget;
        localStorage.setItem(`user_${this.currentUser}`, JSON.stringify(userData));
      }
      
      this.updateDisplay();
      this.showNotification("Succ√®s", `Budget mis √† jour: ${this.budget} DH`, "success");
    }
    document.getElementById("settingsDropdown").classList.add("hidden");
  }

  exportData() {
    if (this.expenses.length === 0) {
      this.showNotification("Info", "Aucune donn√©e √† exporter", "info");
      return;
    }
    
    const csvContent = "data:text/csv;charset=utf-8," + 
      "Date,Description,Montant,Cat√©gorie,Tags\n" +
      this.expenses.map(exp => 
        `${exp.date},${exp.description},${exp.amount},${exp.category},"${(exp.tags || []).join(';')}"`
      ).join("\n");
    
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", `expenses_${this.currentMonthKey}.csv`);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    this.showNotification("Succ√®s", "Donn√©es export√©es", "success");
    document.getElementById("settingsDropdown").classList.add("hidden");
  }

  backupData() {
    const backupData = {
      user: this.currentUser,
      expenses: this.expenses,
      budget: this.budget,
      timestamp: new Date().toISOString()
    };
    
    const dataStr = JSON.stringify(backupData, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    
    const link = document.createElement('a');
    link.href = URL.createObjectURL(dataBlob);
    link.download = `backup_${this.currentUser}_${new Date().toISOString().slice(0,10)}.json`;
    link.click();
    
    this.showNotification("Succ√®s", "Sauvegarde cr√©√©e", "success");
    document.getElementById("settingsDropdown").classList.add("hidden");
  }

  resetData() {
    if (confirm("√ätes-vous s√ªr de vouloir r√©initialiser toutes les donn√©es ? Cette action est irr√©versible.")) {
      this.expenses = [];
      this.saveData();
      this.updateDisplay();
      this.updateCharts();
      this.showNotification("Succ√®s", "Donn√©es r√©initialis√©es", "success");
    }
    document.getElementById("settingsDropdown").classList.add("hidden");
  }

  // M√©thodes pour les boutons du menu flottant
  quickPhotoExpense() {
    this.showModal();
    this.switchTab('photo');
    if (this.isFloatingMenuOpen) this.toggleFloatingMenu();
  }

  quickVoiceExpense() {
    this.showModal();
    this.switchTab('voice');
    if (this.isFloatingMenuOpen) this.toggleFloatingMenu();
  }

  showAISuggestions() {
    this.generateAISuggestions();
    if (this.isFloatingMenuOpen) this.toggleFloatingMenu();
  }

  startVoiceRecording() {
    if (this.voiceRecognition) {
      this.voiceRecognition.start();
      this.showNotification("Info", "√âcoute en cours... Parlez maintenant", "info");
    }
  }

  suggestDescription() {
    const amount = document.getElementById("expAmount").value;
    const category = document.getElementById("expCategory").value;
    
    const suggestions = {
      'Alimentation': ['Restaurant', 'Courses alimentaires', 'Snack', 'Caf√©'],
      'Transport': ['Essence', 'Taxi', 'Bus', 'Parking'],
      'Loisirs': ['Cin√©ma', 'Jeux', 'Sortie', 'Sport'],
      'Shopping': ['V√™tements', 'Accessoires', 'D√©coration', 'Cadeaux']
    };
    
    const categoryOptions = suggestions[category] || ['Divers', 'Achat', 'Service'];
    const suggestion = categoryOptions[Math.floor(Math.random() * categoryOptions.length)];
    
    document.getElementById("expDesc").value = suggestion;
    this.showNotification("IA", `Suggestion: ${suggestion}`, "info");
  }

  showCategoryInsights() {
    const categoryTotals = {};
    this.expenses.forEach(exp => {
      categoryTotals[exp.category] = (categoryTotals[exp.category] || 0) + exp.amount;
    });
    
    const topCategory = Object.entries(categoryTotals)
      .sort(([,a], [,b]) => b - a)[0];
    
    if (topCategory) {
      this.showNotification("Insight", `Top cat√©gorie: ${topCategory[0]} (${topCategory[1].toFixed(2)} DH)`, "info");
    }
  }

  enablePredictiveMode() {
    this.showNotification("IA", "Mode pr√©dictif activ√©", "info");
    // Ici on pourrait afficher des pr√©dictions plus d√©taill√©es
  }

  enableCompareMode() {
    this.showNotification("IA", "Mode comparaison activ√©", "info");
    // Ici on pourrait comparer avec les mois pr√©c√©dents
  }

  showFilterOptions() {
    // Modal de filtres avanc√©s (simplifi√©)
    const filters = prompt("Filtrer par cat√©gorie (s√©par√©es par des virgules):");
    if (filters) {
      const filterArray = filters.split(',').map(f => f.trim());
      const filtered = this.expenses.filter(exp => 
        filterArray.some(filter => 
          exp.category.toLowerCase().includes(filter.toLowerCase())
        )
      );
      this.displayFilteredExpenses(filtered);
    }
  }
}

// Initialisation
const tracker = new PremiumExpenseTracker();

// Fermer les dropdowns en cliquant ailleurs
document.addEventListener('click', (e) => {
  if (!e.target.closest('#settingsBtn') && !e.target.closest('#settingsDropdown')) {
    document.getElementById('settingsDropdown').classList.add('hidden');
  }
});
</script>

</body>
</html>
