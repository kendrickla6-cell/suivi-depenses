<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Suivi D√©penses</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root{
    --bg:#f4f6f8; --card:#fff; --text:#222; --accent:#102E50; --accent-2:#E78B48;
    --ok:#F5C45E; --warn:#E78B48; --danger:#BE3D2A;
  }
  body{font-family:'Cairo',sans-serif;margin:0;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;}
  header{background:var(--accent);color:#fff;padding:12px 16px;display:flex;justify-content:space-between;align-items:center;}
  #welcomeMessage{font-weight:700;font-size:1rem;}
  #headerRight{display:flex;gap:8px;align-items:center;font-size:0.95rem;}
  button,select,input{font-family:inherit}
  main{max-width:920px;margin:18px auto;padding:18px;background:var(--card);border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.06);}
  .controls{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px;align-items:center;}
  input[type="text"],input[type="number"],input[type="month"],select{padding:10px;border-radius:8px;border:1px solid #dcdcdc;font-size:1rem}
  button{background:var(--accent);color:white;border:none;padding:10px 12px;border-radius:8px;cursor:pointer;font-weight:600;}
  button.ghost{background:#fff;color:var(--accent);border:1px solid #ddd}
  button.small{padding:6px 8px;font-size:0.9rem}
  form#addForm{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;align-items:center}
  #depenses{margin-top:12px;display:flex;flex-direction:column;gap:8px;max-height:360px;overflow:auto;padding-bottom:6px}
  .depense{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:#fbfbfd;border:1px solid #eee;transition:all .18s}
  .depense:hover{transform:translateY(-3px)}
  .depense .left{display:flex;gap:10px;align-items:center;flex:1}
  .depense .label{font-weight:600}
  .depense .amount{font-weight:700;color:var(--accent)}
  .depense button.delete{background:transparent;border:none;color:#a33;font-size:1.05rem;cursor:pointer}

  /* mobile cards */
  @media (max-width:768px){
    main{margin:8px;border-radius:0}
    .depense{flex-direction:column;align-items:flex-start;padding:12px;gap:6px}
    .depense .row{width:100%;display:flex;justify-content:space-between;align-items:center}
    .depense .meta{font-size:0.9rem;color:#666}
    .controls{flex-direction:column;align-items:stretch}
    form#addForm{flex-direction:column;align-items:stretch}
    input,select,button{width:100%}
  }

  /* progress / stats */
  .progress-container{width:100%;height:14px;background:#eee;border-radius:999px;overflow:hidden;margin:8px 0}
  .progress-bar{height:100%;width:0;background:linear-gradient(90deg,var(--ok),var(--warn),var(--danger));transition:width .6s ease}

  /* chart */
  canvas{max-width:320px;margin:12px auto;display:block}

  /* alert */
  #alerte{display:none;padding:8px;border-radius:8px;color:#fff;margin-bottom:12px;font-weight:700}
  #alerte.orange{background:var(--warn);display:block}
  #alerte.rouge{background:var(--danger);display:block}

  /* dark mode */
  body.dark{background:#0f1720;color:#e6eef6}
  body.dark main{background:#0b1220}
  body.dark .depense{background:#0b1826;border:1px solid rgba(255,255,255,0.04)}
  body.dark input,body.dark select{background:#091022;color:#e6eef6;border:1px solid rgba(255,255,255,0.06)}
  body.dark button{color:#fff}
  .top-row{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:10px}
  #monthSelect{padding:8px;border-radius:8px}
  .hidden{display:none}
</style>
</head>
<body>

<header>
  <div id="welcomeMessage">Votre suivi des d√©penses</div>
  <div id="headerRight">
    <div id="timeDisplay"></div>
    <button id="darkModeBtn" class="small">üåì</button>
    <button id="changeThresholdBtn" class="small ghost" style="display:none">Modifier seuil</button>
    <button id="logoutBtn" class="small ghost" style="display:none">Se d√©connecter</button>
  </div>
</header>

<main>
  <div id="alerte"></div>

  <!-- login modal -->
  <div id="loginScreen" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);">
    <form id="loginForm" style="background:#fff;padding:20px;border-radius:12px;min-width:320px;max-width:420px;display:flex;flex-direction:column;gap:10px;">
      <h3 id="formTitle">Connexion</h3>
      <div style="display:flex;gap:8px;">
        <button type="button" id="btnLogin" class="ghost" style="flex:1">Connexion</button>
        <button type="button" id="btnRegister" class="ghost" style="flex:1">S'inscrire</button>
      </div>
      <input id="username" type="text" placeholder="Nom" required />
      <input id="password" type="password" placeholder="Mot de passe" required />
      <input id="maxThreshold" type="number" placeholder="Seuil max (MAD)" min="1" style="display:none;" />
      <select id="secretQuestion" style="display:none">
        <option value="">-- Question secr√®te --</option>
        <option value="animal">Quel est le nom de votre premier animal ?</option>
        <option value="ville">Quelle est votre ville natale ?</option>
        <option value="mere">Quel est le pr√©nom de votre m√®re ?</option>
      </select>
      <input id="secretAnswer" type="text" placeholder="R√©ponse secr√®te" style="display:none" />
      <div style="display:flex;gap:8px">
        <button id="submitBtn" type="submit" style="flex:1">Entrer</button>
        <button id="forgotPasswordBtn" type="button" class="ghost" style="flex:1">Mot de passe oubli√© ?</button>
      </div>
    </fo
